language: swift
osx_image: xcode11.2
env:
  global:
  - COMPANY="Brit Solucoes Integradas de Tecnologia Ltda."
  - COMPANY_ID="7PXVC8PJ97"
  - APP_NAME="MacMagazine"
  - 'DEVELOPER_NAME="iPhone Distribution: $COMPANY ($COMPANY_ID)"'
  - PROFILE_NAME="MacMagazine"
  - DESTINATION="platform=iOS Simulator,OS=13.2.2,name=iPhone 11 Pro"
  - BRANCH="release/4.0"
jobs:
  include:
  - stage: test
    script:
    - xcodebuild clean analyze test -project "$APP_NAME".xcodeproj -scheme "$APP_NAME" -destination "$DESTINATION"
  - stage: deploy
    before_script:
    - openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.cer.enc -d -a -out scripts/certs/dist.cer
    - openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.p12.enc -d -a -out scripts/certs/dist.p12
    script:
    - "./scripts/add-key.sh"
    - "./scripts/add-key.sh"
stages:
- name: test
  if: type = pull_request
- name: deploy
  if: type = push AND branch = release/4.0
dd:
  secure: BOJ/TARPtpTB+ECfFlQGVZ0WBtYQ5PqAa7UNszveQlHl6x44AqsqgjrDvvANSTb+l3BGMrgtns6ro1enPghJM5HkyW04h+bhM5y4mMNZxvPGh+Z9Ko9xmg3NwoEvizYNvnFwe2A+5oopyxn6wwX844iQiY6u4UdfErOABRQgb7xSftEujwylRv6F/2lnU1FYj9pW461p0CQF/ldLgQMrx6SiQoaexclYv+4wLlzzxICUXfgECGo4a8F9g53XTO/jVKQdl3CRHjNKrW1Tu3KjD46vdkrD3JI1GgY6YeodxMDEsatsMahNupLiWHm8PjsieG5qrMNCsn8cEZKyyYKlB90b7yxqWC/KP5qsgaXCWac3NoQbm5fquCNWc/ri+uFNsNIDU36BBUiMV5yAjIhDRUzCyJrnuVBUE3yy4NT9xpvKkgJebw42cQU7fpu6tJscrEPYPtqw09A3h8y7aVM0WY7n5COPHhCbkZ7XIFbvYFq5XlWYOPj3tSfFjbhreWSwK93TnCErWILfkOv2ViaQ2Co/3mZVMUZTktLwWHq3ek0nIcpgN6PCOHfik96JEhVUfjTzINXem8q3D2ATGPEqj5vrTskw3IkF27lr5MbkPd1n/SAvmmN3tl7VKswQBIxRDWQhWvFFqUbQfil7LTrjd1x/rjECl3quY32SuJPyEKo=
